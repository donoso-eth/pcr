<div class="grid">
  <div class="col-12">
    <div *ngIf="toUpdateReward !== undefined" style="position: relative; border-color: transparent" class="card">
      <h5>{{ toUpdateReward!.title }}</h5>

      <div style="margin-top: 20px" class="grid p-fluid">
        <div class="col-12">
          <div style="position: absolute; right: 25px;top: 10px;">
            <p-inputSwitch (onChange)="changeStatus($event.checked)" [(ngModel)]="rewardStatus"> </p-inputSwitch>
          </div>

          <br />
          <textarea pInputTextarea placeholder="Your Message"  readonly [autoResize]="true" cols="30">{{ toUpdateReward!.displayCustomAncillaryData }}</textarea>

          <!-- ////// STATUS PROPOSAL -->

          <div style="position: relative; background-color: var(--surface-ground)" class="card mt-3 flex align-items-center flex-column justify-content-center">
            <!-- <div style="width:100%;" class="grid p-fluid">
                          <p-steps class="col-12" [model]="routeItems" (activeIndexChange)="activeStep = 0"
                            [(activeIndex)]="activeStep" styleClass="mt-5" [readonly]="false"></p-steps>
                        </div> -->
            <proposal-detail (proposeValue)="proposeValue($event)"  (executeProposal)="executeProposal()" style="width: 100%" *ngIf="currentProposal !== undefined" [proposal]="currentProposal"></proposal-detail>
          </div>

          <!-- ////// blocks -->

          <div style="margin-top: 20px" class="grid">
            <div class="col-12 lg:col-6 xl:col-6">
              <div style="background-color: var(--surface-ground)" class="card mb-0">
                <div class="grid p-fluid justify-content-center">
                  <div class="col-12 flex align-items-center">
                    <div
                      [style.background]="+toUpdateReward!.unitsIssued > 0 ? 'var(--green-500)' : 'var(--orange-500)'"
                      style="width: 25px; height: 25px; border-radius: 13px; background: lightgreen"
                    ></div>
                    <span class="block text-500 font-medium ml-2"> Summary</span>
                  </div>
                  <!-- #region ISSUERS  ////  -->
                  <div class="col-4 text-center">
                    <div class="flex justify-content-between flex-column mb-3">
                      <div class="text-900 font-medium text-xl">
                        Members <br />
                        <span [class]="+toUpdateReward!.unitsIssued > 0 ? 'text-green-500' : 'text-orange-500'"> {{ toUpdateReward!.unitsIssued }}</span>
                      </div>
                    </div>
                  </div>

                  <!-- #endregion ISSUERS  ////  -->

                  <!-- #region INDEX ////  -->
                  <div class="col-4 text-center">
                    <div class="flex justify-content-between flex-column mb-3">
                      <div class="text-900 font-medium text-xl">
                        Index <br />
                        <span> {{ toUpdateReward!.currentIndex }}$/unit</span>
                      </div>
                    </div>
                  </div>
                  <!-- #endregion INDEX////  -->

                  <!-- #region TOTAL  ////  -->
                  <div class="col-4 text-center">
                    <div class="flex justify-content-between flex-column mb-3">
                      <div class="text-900 font-medium text-xl">
                        Distributed<br />
                        <span> {{ toUpdateReward!.totalDistributed }}</span>
                      </div>
                    </div>
                  </div>
                  <!-- #endregion INDEX////  -->
                  <button
                    pButton
                    pRipple
                    style="position: relative; width: fit-content"
                    (click)="showAddMembers(toUpdateReward!)"
                    type="button"
                    label="Add Member"
                    class="p-button-rounded mr-2 mb-2"
                  ></button>
                </div>
              </div>
            </div>
            <div class="col-12 lg:col-6 xl:col-6">
              <div style="background-color: var(--surface-ground)" class="card mb-0">
                <div class="grid p-fluid justify-content-center">
                  <div style="position:relative;" class="col-12 flex align-items-center">
                    <div
                    [style.background]="+toUpdateReward!.rewardAmount <= +toUpdateReward!.currentdeposit ? 'var(--green-500)' : 'var(--orange-500)'"
                      style="width: 25px; height: 25px; border-radius: 13px; background: lightgreen"
                    ></div>
                    <span class="block text-500 font-medium ml-2"> Deposit</span>
                    <img src="assets/images/tokens/{{ toUpdateReward!?.fundToken?.image }}_icon.svg" style="position: absolute; width: 40px;right: 20px;" />
            
                  </div>
                  <!-- #region CURRENT DEPOSIT ////  -->
                  <div class="col-6 text-center">
                    <div class="flex justify-content-between flex-column mb-3">
                      <div class="text-900 font-medium text-xl">
                        Current<br />
                        <span [class]="+toUpdateReward!.rewardAmount <= +toUpdateReward!.currentdeposit ? 'text-green-500' : 'text-orange-500'" >  ${{ toUpdateReward!.currentdeposit }}</span>
                      </div>
                    </div>
                  </div>

                  <!-- #endregion CURRENT DEPOSIT ////  -->

                  <!-- #region REQUIRED DEPOSIT ////  -->
                  <div class="col-6 text-center">
                    <div class="flex justify-content-between flex-column mb-3">
                      <div class="text-900 font-medium text-xl">
                       Reward Amount<br />
                        <span> ${{ toUpdateReward!.rewardAmount }}</span>
                      </div>
                    </div>
                  </div>
                  <!-- #endregion REQUIRED DEPOSIT ////  -->

                  <div class="col-12 flex justify-content-around">
                  <button pButton pRipple style="width: fit-content" (click)="showFunding()" type="button" label="Fund" class="p-button-rounded mr-2 mb-2"></button>
                  <button pButton pRipple style="width: fit-content" (click)="showUpdateRewardAmount()" type="button" label="Change" class="p-button-rounded mr-2 mb-2"></button>
                </div>
                </div>
              </div>
            </div>
          </div>

          <!-- ////// CHARTSSS  -->
          <div style="margin-top: 20px" class="grid p-fluid">
            <div class="col-12 lg:col-6 xl:col-6">
              <div class="card">
                <h5>Index Evolution</h5>
                <p *ngIf="showIndexChart == false">Units to members not yet issued</p>
                <p-chart *ngIf="chartData != undefined && showIndexChart == true" type="line" [data]="chartData" [options]="chartOptions"></p-chart>
              </div>
            </div>
            <div class="col-12 lg:col-6 xl:col-6">
              <div class="card">
                <h5>Last Distributions</h5>
                <p *ngIf="showDistributionChart == false">Proposals not yet execued</p>
                <p-chart  *ngIf="distributionsChartData!= undefined && showDistributionChart == true && toUpdateReward?.priceType == 0" type="bar" [data]="distributionsChartData" [options]="distributionsChartOptions"></p-chart>
                <p-chart  *ngIf="distributionsChartData!= undefined && showDistributionChart == true && toUpdateReward?.priceType == 1" type="line" [data]="distributionsChartData" [options]="distributionsChartOptions"></p-chart>
         
              </div>
            </div>
          </div>

          <div *ngIf="toUpdateReward! == undefined" class="card">
            <div class="grid flex flex-column align-items-center">
              <div class="flex justify-content-center align-items-center bg-pink-500 border-circle" style="height: 3.2rem; width: 3.2rem">
                <i class="pi pi-fw pi-exclamation-circle text-2xl text-white"></i>
              </div>
              <h1 class="text-900 font-bold text-5xl mb-2">Nothing Found</h1>
              <span class="text-600">Please create a new Perpetual Conditional toUpdateReward!</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<p-dialog header="Let's Add People!" [(visible)]="showIssuingState" [modal]="true" showEffect="fade" [style]="{ width: '40vw' }" [breakpoints]="{ '960px': '75vw' }">
  <p class="line-height-3 m-0">
    Please add the addresess <span style="color: green">"{{ toUpdateReward?.title }}"</span> <br />
    <!-- It requires the {{ toUpdateReward?.fundToken?.name }} superToken, your current balance is: {{ toUpdateReward!?.fundToken?.superTokenBalance!}}. You may wamt to: -->
  </p>
  <h6>Members</h6>
  <p class="flex justify-content-between">
    <input [formControl]="adressesCtrl" pInputText type="text" placeholder="Member to Add" />
    <button pButton icon="pi pi-check" label="Add" (click)="doAddMember(toUpdateReward!)" class="p-button-outlined"></button>
  </p>
  <!-- <ng-template pTemplate="footer">
    <button pButton icon="pi pi-check" label="Fund" class="p-button-outlined"></button>
  </ng-template> -->
</p-dialog>

<p-dialog header="Updating the Reward Amount" [(visible)]="showingUpdateAmount" [modal]="true" showEffect="fade" [style]="{ width: '40vw' }" [breakpoints]="{ '960px': '75vw' }">
  <p class="line-height-3 m-0">
    You are about to fund the PCR Token <span style="color: green">"{{ toUpdateReward!?.title }}"</span> Your current balalnce is {{toUpdateReward!?.fundToken?.rewardTokenBalance!}} DAIx   <br />
    It requires the {{ toUpdateReward!?.fundToken?.name }} superToken, your current balance is: {{toUpdateReward!?.fundToken?.superTokenBalance!}} DAIx . You may want to:
  </p>
  <h6>Fund The PCR Token</h6>
  <p class="flex justify-content-between">
    <p-inputNumber [formControl]="toUpdateAmountCtrl" placeholder="Amount" mode="decimal" [showButtons]="true" [min]="0"> </p-inputNumber>
    <button pButton icon="pi pi-check" label="Change" (click)="doUpdateRewardAmount()" class="p-button-outlined"></button>
  </p>


</p-dialog>


<p-dialog header="Let's fund!" [(visible)]="showFundingState" [modal]="true" showEffect="fade" [style]="{ width: '50vw' }" [breakpoints]="{ '960px': '80vw' }">
  <p class="line-height-3 m-0">
    You are about to fund the PCR Token <span style="color: green">"{{ toUpdateReward!?.title }}"</span> Your current balance is <span style="font-weight:bold;color:var(--primary-color)">{{toUpdateReward!?.fundToken?.rewardTokenBalance!}} DAI </span>   <br />
    It requires the {{ toUpdateReward!?.fundToken?.name }} superToken, your current balance is: <span style="font-weight:bold;color:var(--primary-color)">{{toUpdateReward!?.fundToken?.superTokenBalance!}} DAIx </span>. You may want to:
  </p>
  <h6>Fund The PCR with SuperToken DAIx (values in tokens)</h6>
  <p class="flex justify-content-between" *ngIf="+toUpdateReward!?.fundToken?.superTokenBalance! > +toUpdateReward!?.rewardAmount!">
    <p-inputNumber [formControl]="toFundAmountCtrl" placeholder="Amount" mode="decimal" [showButtons]="true" [min]="0"> </p-inputNumber>
    <button pButton icon="pi pi-check" label="Fund" (click)="doFunding()" class="p-button-outlined"></button>
  </p>
  <h6>Upgrade from DAI to DAIx (values in tokens)</h6>
  <p class="flex justify-content-between" *ngIf="+toUpdateReward!?.fundToken?.superTokenBalance! > +toUpdateReward!?.rewardAmount!">

    <p-inputNumber [formControl]="toUpgradeAmountCtrl" placeholder="Amount" mode="decimal" [showButtons]="true" [min]="0"> </p-inputNumber>
    <button pButton icon="pi pi-check" label="Upgrade" (click)="doUpgrade()" class="p-button-outlined"></button>
  </p>
  <h6>Downgrade from DAIx to DAI (values in tokens)</h6>
  <p class="flex justify-content-between" *ngIf="+toUpdateReward!?.fundToken?.superTokenBalance! > +toUpdateReward!?.rewardAmount!">
 
    <p-inputNumber [formControl]="toDowngradeAmountCtrl" placeholder="Amount" mode="decimal" [showButtons]="true" [min]="0"> </p-inputNumber>
    <button pButton icon="pi pi-check" label="Downgrade" (click)="doDowngrade()" class="p-button-outlined"></button>
  </p>
  <ng-template pTemplate="footer">
    <!-- <button pButton icon="pi pi-check" label="Fund" class="p-button-outlined"></button> -->
  </ng-template>
</p-dialog>
